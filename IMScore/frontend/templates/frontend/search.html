{% extends 'frontend/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block page_title %}Search{% endblock %}

{% block custom_css %}
    <link href="{% static 'frontend/assets/js/plugins/tagsinput/bootstrap-tagsinput.css' %}">
    <link href="{% static 'frontend/assets/js/plugins/tagsinput/bootstrap-tagsinput-typeahead.css' %}">
{% endblock %}

{% block back_button %}{% endblock %}

{% block page_content %}

    <!-- Page Content -->
    <div class="content">
        <div class="row">
            <div class="col-md-5 col-xl-3">
                <!-- Toggle Inbox Side Navigation -->
                <div class="d-md-none push">
                    <!-- Class Toggle, functionality initialized in Helpers.coreToggleClass() -->
                    <button type="button" class="btn btn-block btn-primary" data-toggle="class-toggle"
                            data-target="#one-inbox-side-nav" data-class="d-none">
                        Inbox Menu
                    </button>
                </div>
                <!-- END Toggle Inbox Side Navigation -->

                <!-- Inbox Side Navigation -->
                <div id="one-inbox-side-nav" class="d-none d-md-block push">
                    <!-- Inbox Menu -->
                    <div class="block block-rounded">
                        <div class="block-header block-header-default">
                            <h3 class="block-title">Search</h3>
                            <div class="block-options">
                                <button type="reset" class="btn btn-sm btn-outline-danger" id="id_reset_button">Reset
                                </button>
                            </div>
                        </div>
                        <div class="block-content">
                            <form action="" method="GET" id="id_search_form">
                                <div class="form-group form-row">
                                    {% render_field intelFilter.form.title class="form-control" placeholder=intelFilter.form.title.label %}
                                </div>

                                <div class="form-group form-row">
                                    {% render_field intelFilter.form.description class="form-control" placeholder=intelFilter.form.description.label %}
                                </div>

                                <div class="form-group form-row">
                                    {% render_field intelFilter.form.resource_type class="form-control" placeholder=intelFilter.form.resource_type.label %}
                                </div>

                                {# creation date #}
                                <div class="form-group form-row">
                                    <div class="form-group">
                                        <div class="input-daterange input-group js-datepicker-enabled"
                                             data-date-format="mm/dd/yyyy" data-week-start="1" data-autoclose="true"
                                             data-today-highlight="true">
                                            <input type="text" name="creation_date_range_after" class="form-control"
                                                   id="id_creation_date_range_0" placeholder="From">
                                            <div class="input-group-prepend input-group-append">
                                                <span class="input-group-text font-w600">
                                                    <i class="fa fa-fw fa-arrow-right"></i>
                                                </span>
                                            </div>
                                            <input type="text" name="creation_date_range_before" class="form-control"
                                                   id="id_creation_date_range_1" placeholder="To">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group form-row">
                                    <div class="col-9 ">
                                        <select id="id_tags" name="tag" multiple></select>
                                    </div>
                                </div>

                                <div class="row items-push">
                                    <div class="col-lg-12  text-right">
                                        <input type="submit" class="btn btn-primary" value="Search">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- END Inbox Menu -->
                </div>
                <!-- END Inbox Side Navigation -->
            </div>
            <div class="col-md-7 col-xl-9">
                <!-- Message List -->
                <div class="block">
                    <div class="block-header block-header-default">
                        <h3 class="block-title">
                            15-30 <span class="font-w400 text-lowercase">from</span> 700
                        </h3>
                        <div class="block-options">
                            <button type="button" class="btn-block-option" data-toggle="tooltip" data-placement="left"
                                    title="Previous 15 Messages">
                                <i class="si si-arrow-left"></i>
                            </button>
                            <button type="button" class="btn-block-option" data-toggle="tooltip" data-placement="left"
                                    title="Next 15 Messages">
                                <i class="si si-arrow-right"></i>
                            </button>
                            <button type="button" class="btn-block-option" data-toggle="block-option"
                                    data-action="state_toggle" data-action-mode="demo">
                                <i class="si si-refresh"></i>
                            </button>
                            <button type="button" class="btn-block-option" data-toggle="block-option"
                                    data-action="fullscreen_toggle"></button>
                        </div>
                    </div>
                    <div class="block-content">
                        <!-- Messages Options -->
                        <div class="d-flex justify-content-between push">
                            <div class="btn-group">
                                <button class="btn btn-sm btn-light" type="button">
                                    <i class="fa fa-archive text-primary"></i>
                                    <span class="d-none d-sm-inline ml-1">Archive</span>
                                </button>
                                <button class="btn btn-sm btn-light" type="button">
                                    <i class="fa fa-star text-warning"></i>
                                    <span class="d-none d-sm-inline ml-1">Star</span>
                                </button>
                            </div>
                            <button class="btn btn-sm btn-light" type="button">
                                <i class="fa fa-times text-danger"></i>
                                <span class="d-none d-sm-inline ml-1">Delete</span>
                            </button>
                        </div>
                        <!-- END Messages Options -->

                        <!-- Messages and Checkable Table (.js-table-checkable class is initialized in Helpers.tableToolsCheckable()) -->
                        <div class="pull-x">
                            <table class="js-table-checkable table table-hover table-vcenter font-size-sm">
                                <tbody>
                                <tr>
                                    <td class="text-center" style="width: 60px;">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg15"
                                                   name="inbox-msg15">
                                            <label class="custom-control-label font-w400" for="inbox-msg15"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600" style="width: 140px;">Brian Cruz</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Welcome to our service</a>
                                        <div class="text-muted mt-1">It's a pleasure to have you on our service..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted" style="width: 80px;">
                                        <i class="fa fa-paperclip mr-1"></i> (3)
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted" style="width: 120px;">
                                        <em>2 min ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg14"
                                                   name="inbox-msg14">
                                            <label class="custom-control-label font-w400" for="inbox-msg14"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Ryan Flores</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Your subscription was updated</a>
                                        <div class="text-muted mt-1">We are glad you decided to go with a vip..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <i class="fa fa-paperclip mr-1"></i> (2)
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>10 min ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg13"
                                                   name="inbox-msg13">
                                            <label class="custom-control-label font-w400" for="inbox-msg13"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Andrea Gardner</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Update is available</a>
                                        <div class="text-muted mt-1">An update is under way for your app..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted"></td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>25 min ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg12"
                                                   name="inbox-msg12">
                                            <label class="custom-control-label font-w400" for="inbox-msg12"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Jack Greene</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">New Sale!</a>
                                        <div class="text-muted mt-1">You had a new sale and earned..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <i class="fa fa-paperclip mr-1"></i> (1)
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>30 min ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg11"
                                                   name="inbox-msg11">
                                            <label class="custom-control-label font-w400" for="inbox-msg11"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Brian Cruz</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Action Required for your account!</a>
                                        <div class="text-muted mt-1">Your account is inactive for a long time and..
                                        </div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted"></td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>1 hour ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg10"
                                                   name="inbox-msg10">
                                            <label class="custom-control-label font-w400" for="inbox-msg10"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Thomas Riley</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">New Photo Pack!</a>
                                        <div class="text-muted mt-1">Our new photo pack is available now! You..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted"></td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>2 hrs ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg9"
                                                   name="inbox-msg9">
                                            <label class="custom-control-label font-w400" for="inbox-msg9"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Alice Moore</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Product is released!</a>
                                        <div class="text-muted mt-1">This is a notification about our new product..
                                        </div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <i class="fa fa-paperclip mr-1"></i> (1)
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>1 day ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg8"
                                                   name="inbox-msg8">
                                            <label class="custom-control-label font-w400" for="inbox-msg8"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Ralph Murray</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Now on Sale!</a>
                                        <div class="text-muted mt-1">Our Book is out! You can buy a copy and..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <i class="fa fa-paperclip mr-1"></i> (9)
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>1 day ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg7"
                                                   name="inbox-msg7">
                                            <label class="custom-control-label font-w400" for="inbox-msg7"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">David Fuller</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Monthly Report</a>
                                        <div class="text-muted mt-1">The monthly report you requested for..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <i class="fa fa-paperclip mr-1"></i> (6)
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>3 days ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg6"
                                                   name="inbox-msg6">
                                            <label class="custom-control-label font-w400" for="inbox-msg6"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Scott Young</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Trial Started!</a>
                                        <div class="text-muted mt-1">You 30-day trial has now started and..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted"></td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>3 days ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg5"
                                                   name="inbox-msg5">
                                            <label class="custom-control-label font-w400" for="inbox-msg5"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Jose Wagner</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Invoice #INV001645</a>
                                        <div class="text-muted mt-1">This is the invoice for the project we..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted"></td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>5 days ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg4"
                                                   name="inbox-msg4">
                                            <label class="custom-control-label font-w400" for="inbox-msg4"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Adam McCoy</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Friend Request!</a>
                                        <div class="text-muted mt-1">You have a new friend request. Click the..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <i class="fa fa-paperclip mr-1"></i> (5)
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>1 week ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg3"
                                                   name="inbox-msg3">
                                            <label class="custom-control-label font-w400" for="inbox-msg3"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Thomas Riley</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Enjoy life!</a>
                                        <div class="text-muted mt-1">Thank you for helping us with our cause...</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <i class="fa fa-paperclip mr-1"></i> (3)
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>1 week ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg2"
                                                   name="inbox-msg2">
                                            <label class="custom-control-label font-w400" for="inbox-msg2"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Carl Wells</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">New Twitter follower!</a>
                                        <div class="text-muted mt-1">You have a new follower, congratulations..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <i class="fa fa-paperclip mr-1"></i> (1)
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>2 weeks ago</em>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="inbox-msg1"
                                                   name="inbox-msg1">
                                            <label class="custom-control-label font-w400" for="inbox-msg1"></label>
                                        </div>
                                    </td>
                                    <td class="d-none d-sm-table-cell font-w600">Melissa Rice</td>
                                    <td>
                                        <a class="font-w600" data-toggle="modal" data-target="#one-inbox-message"
                                           href="#">Huge Discount available!</a>
                                        <div class="text-muted mt-1">Due to the fact that you are a great..</div>
                                    </td>
                                    <td class="d-none d-xl-table-cell text-muted"></td>
                                    <td class="d-none d-xl-table-cell text-muted">
                                        <em>3 weeks ago</em>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <!-- END Messages and Checkable Table -->
                    </div>
                </div>
                <!-- END Message List -->
            </div>
        </div>
    </div>
    <!-- END Page Content -->

{% endblock %}


{% block custom_js %}
    {# tags #}
    <script src="{% static 'frontend/assets/js/plugins/tagsinput/bootstrap-tagsinput.js' %}"></script>
    <script src="{% static "frontend/assets/js/plugins/typeahead/typeahead.js" %}"></script>
    <script src="{% static "frontend/assets/javascript/load_tags_name.js" %}"></script>
    {#  utils #}
    <script src="{% static "frontend/assets/javascript/utils.js" %}"></script>
    {# date #}
    <script src="{% static "frontend/assets/js/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" %}"></script>
    {# search #}
    <script src="{% static "frontend/assets/javascript/search.js" %}"></script>



    <script>
        $(document).ready(function () {
            var base_detail_view_endpoint = "/view/";
            var api_endpoint = "{% url 'intels-list' %}";

            // init tags
            load_tags();

            // init dates
            let date_picker_options = {
                format: 'yyyy-mm-dd',
            }
            $("#id_creation_date_range_0").datepicker(date_picker_options);
            $("#id_creation_date_range_1").datepicker(date_picker_options);

            // init search form
            $('#id_reset_button').click(function (event) {
                event.preventDefault();
                $('#id_search_form')[0].reset();
                ajax_load_all_resources(api_endpoint, base_detail_view_endpoint);
            });
            $('#id_search_form').on("submit", function (event) {
                event.preventDefault();
                ajax_load_filtered_intels(api_endpoint, base_detail_view_endpoint, $(this).serializeArray(), null);
            });

            // load resources content
            ajax_load_all_resources(api_endpoint, base_detail_view_endpoint);
        });
    </script>
{% endblock %}