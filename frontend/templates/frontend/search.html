{% extends 'frontend/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block page_title %}Search{% endblock %}

{% block custom_css %}
    <link href="{% static 'frontend/assets/js/plugins/tagsinput/bootstrap-tagsinput.css' %}">
    <link href="{% static 'frontend/assets/js/plugins/tagsinput/bootstrap-tagsinput-typeahead.css' %}">
{% endblock %}

{% block page_content %}

<!-- Search -->
<div class="content">
    <div class="block">
        <div class="block-header">
            <h3 class="block-title">Search</h3>
        </div>
        <div class="block-content block-content-full">
            <div class="row push">

                <div class="col-lg-9">
                    <!-- Form Grid -->
                    <form action="" method="GET" id="id_search_form">
                        <div class="form-group form-row">
                            <div class="col-5">
                                {% render_field intelFilter.form.title class="form-control form-control-alt" placeholder=intelFilter.form.title.label %}
                            </div>
                        </div>

                        {# creation date #}
                        <div class="form-group form-row">
                            <div class="form-group">
                                <div class="input-daterange input-group js-datepicker-enabled" data-date-format="mm/dd/yyyy" data-week-start="1" data-autoclose="true" data-today-highlight="true">
                                    <input type="text" name="creation_date_range_after" class="form-control" id="id_creation_date_range_0" placeholder="From">
                                    <div class="input-group-prepend input-group-append">
                                        <span class="input-group-text font-w600">
                                            <i class="fa fa-fw fa-arrow-right"></i>
                                        </span>
                                    </div>
                                    <input type="text" name="creation_date_range_before" class="form-control" id="id_creation_date_range_1" placeholder="To">
                                </div>
                            </div>
                        </div>

                        <div class="form-group form-row">
                            <div class="col-9 ">
                                <select id="id_tags" name="tag" multiple></select>
                            </div>
                        </div>

                        <div class="row items-push">
                            <div class="col-lg-7 offset-lg-4">
                                <button class="btn  btn-outline-dark" id="id_reset_button">Reset</button>
                                <input type="submit" class="btn btn-primary" value="Search">
                            </div>
                        </div>


                    </form>
                    <!-- END Form Grid -->
                </div>
                <div class="col-lg-3">
                    <p class="font-size-sm text-muted">
                    </p>
                </div>
            </div>

        </div>
    </div>
</div>
<!-- END Search -->





<!-- Page Content -->
<div class="content">
    <div class="row">
        <div class="col-md-12">
            <!-- Results -->
            <div class="block">
                <div class="block-content tab-content overflow-hidden">
                    <!-- Projects -->
                    <div class="tab-pane fade fade-up show active" id="search-projects" role="tabpanel">
                        <div class="font-size-h4 font-w600 p-2 mb-4 border-left border-4x border-primary bg-body-light" id="id_results_banner">
                            <span class="text-primary font-w700" id="id_results_banner_number"></span> results found.
                        </div>
                        <table class="table table-striped table-vcenter">
                            <thead>
                                <tr>
                                    <th style="width: 50%;">Title</th>
                                    <th class="d-none d-lg-table-cell text-center" style="width: 15%;">Type</th>
                                    <th class="d-none d-lg-table-cell text-center" style="width: 15%;">Tags</th>
                                    <th class="d-none d-lg-table-cell text-center" style="width: 15%;">Link</th>
                                </tr>
                            </thead>
                            <tbody id="id_search_results_body">
                            </tbody>
                        </table>

                        <nav aria-label="Projects Search Navigation">
                            <ul class="pagination pagination-sm">
                                <li class="page-item">
                                    <a class="page-link" id="id_prev" tabindex="-1" aria-label="Previous">
                                        Prev
                                    </a>
                                </li>
                                <li class="page-item active">
                                    <span class="page-link" id="id_page_num">1</span>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" id="id_next" aria-label="Next">
                                        Next
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                    <!-- END Projects -->
                </div>
            </div>
            <!-- END Results -->
        </div>


    </div>

<!-- END Page Content -->
{% endblock %}

{% block custom_js %}
    {# tags #}
    <script src="{% static 'frontend/assets/js/plugins/tagsinput/bootstrap-tagsinput.js' %}"></script>
    <script src="{% static "frontend/assets/js/plugins/typeahead/typeahead.js" %}"></script>
    <script src="{% static "frontend/assets/javascript/load_tags.js" %}"></script>
    {#  utils #}
    <script src="{% static "frontend/assets/javascript/utils.js" %}"></script>
    {# date #}
    <script src="{% static "frontend/assets/js/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" %}"></script>
    {# search #}
    <script src="{% static "frontend/assets/javascript/search.js" %}"></script>



    <script>
        $( document ).ready(function() {
            var base_detail_view_endpoint = "/view/";
            var api_endpoint = "{% url 'intels-list' %}";

            // init tags
            load_tags();

            // init dates
            let date_picker_options = {
                format: 'yyyy-mm-dd',
            }
            $("#id_creation_date_range_0").datepicker(date_picker_options);
            $("#id_creation_date_range_1").datepicker(date_picker_options);

            // init search form
            $('#id_reset_button').click(function (event){
                event.preventDefault();
                $('#id_search_form')[0].reset();
                ajax_load_all_resources(api_endpoint, base_detail_view_endpoint);
            });
            $('#id_search_form').on( "submit", function( event ) {
                  event.preventDefault();
                  ajax_load_filtered_intels(api_endpoint, base_detail_view_endpoint, $( this ).serializeArray(), null);
                });

            // load resources content
            ajax_load_all_resources(api_endpoint, base_detail_view_endpoint);
        });
    </script>
{% endblock %}